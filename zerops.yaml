zerops:
  - setup: signoz
    run:
      base: ubuntu@22.04
      envVariables:
        CLICKHOUSE_HOST: ${clickhouse_hostname}
        CLICKHOUSE_PORT: ${clickhouse_port}
        CLICKHOUSE_DATABASE: ${clickhouse_database}
        CLICKHOUSE_USER: ${clickhouse_user}
        CLICKHOUSE_PASSWORD: ${clickhouse_password}
        DEPLOYMENT_TYPE: query-service
        OTEL_COLLECTOR_ENABLED: false
        SYSLOG_RECEIVER_ENABLED: true
        PROMETHEUS_REMOTE_WRITE_ENABLED: true
      ports:
        - port: 8080
          httpSupport: true
        - port: 514
        - port: 514
          protocol: udp
        - port: 9090
          httpSupport: true
      prepareCommands:
        - wget https://github.com/SigNoz/signoz/releases/download/v0.45.0/signoz-linux-amd64 -O /usr/local/bin/signoz
        - chmod +x /usr/local/bin/signoz
      initCommands:
        - signoz migrate
      start: signoz start

  - setup: otelcollector
    run:
      base: ubuntu@22.04
      envVariables:
        OTEL_EXPORTER_OTLP_ENDPOINT: http://signoz:4317
        OTEL_EXPORTER_OTLP_INSECURE: true
      ports:
        - port: 4317
          protocol: tcp
        - port: 4318
          httpSupport: true
      prepareCommands:
        - wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.96.0/otelcol_0.96.0_linux_amd64.tar.gz
        - tar -xzf otelcol_0.96.0_linux_amd64.tar.gz
        - mv otelcol /usr/local/bin/
      start: otelcol --config=otel-config.yaml
