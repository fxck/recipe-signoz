zerops:
  - setup: signoz
    run:
      base: ubuntu@22.04
      envVariables:
        SIGNOZ_SQLSTORE_PROVIDER: postgres
        SIGNOZ_SQLSTORE_POSTGRES_DSN: postgres://${metadata_user}:${metadata_password}@metadata:5432/${metadata_database}?sslmode=disable
        SIGNOZ_TELEMETRYSTORE_PROVIDER: clickhouse
        SIGNOZ_TELEMETRYSTORE_CLICKHOUSE_DSN: tcp://${clickhouse_hostname}:${clickhouse_port}?username=${clickhouse_user}&password=${clickhouse_password}&database=${clickhouse_database}
        SIGNOZ_WEB_UI_PATH: /etc/signoz/web
      ports:
        - port: 3301
          httpSupport: true
        - port: 514
        - port: 514
          protocol: udp
        - port: 9090
          httpSupport: true
      prepareCommands:
        - wget https://github.com/SigNoz/signoz/releases/download/v0.95.1/signoz_linux_amd64.tar.gz
        - tar -xzf signoz_linux_amd64.tar.gz
        - sudo mkdir -p /etc/signoz
        - sudo cp -r signoz_linux_amd64/web /etc/signoz/
        - sudo cp -r signoz_linux_amd64/config /etc/signoz/ || true
        - sudo cp signoz_linux_amd64/bin/signoz /usr/local/bin/
        - sudo chmod +x /usr/local/bin/signoz
      start: signoz server

  - setup: otelcollector
    run:
      base: ubuntu@22.04
      envVariables:
        OTEL_EXPORTER_OTLP_ENDPOINT: http://signoz:4317
        OTEL_EXPORTER_OTLP_INSECURE: true
      ports:
        - port: 4317
          protocol: tcp
        - port: 4318
          httpSupport: true
      prepareCommands:
        - wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.135.0/otelcol-contrib_0.135.0_linux_amd64.tar.gz
        - tar -xzf otelcol-contrib_0.135.0_linux_amd64.tar.gz
        - sudo mv otelcol-contrib /usr/local/bin/otelcol
      start: otelcol --config=otel-config.yaml
